<ion-header>
  <ion-toolbar>
    <ion-title>Crisis Plans</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>


  

  <!-- âœ… List of plans -->
  <ion-list>
    <ion-item *ngFor="let plan of crisisPlans" lines="none">
      <ion-label class="ion-text-wrap">
        <!-- Plan title -->
        <h2>{{ plan.title }}</h2>

        <!-- Reorderable steps -->
        <ion-reorder-group
          [disabled]="false"
          (ionItemReorder)="reorderSteps($event, plan)"
        >
          <ion-item *ngFor="let step of plan.steps; let i = index">
            <ion-label style="white-space: pre-line;" [innerHTML]="formatUserText(step)"></ion-label>

            <!-- Edit/Delete buttons -->
            <app-button
              size="icon"
              color="default"
              icon="create"
              (clicked)="openEditStep(plan, i)"
            ></app-button>

            <app-button
              size="icon"
              color="red"
              icon="trash"
              (clicked)="deleteStep(plan, i)"
            ></app-button>

            <!-- Drag handle -->
            <ion-reorder slot="end"></ion-reorder>
          </ion-item>
        </ion-reorder-group>

        <!-- Plan-level actions -->
        <div class="plan-actions">
          <app-button
            size="iconWithText"
            color="default"
            icon="create"
            label="Edit Plan"
            (clicked)="openEditPlan(plan)"
          ></app-button>

          <app-button
            size="iconWithText"
            color="red"
            icon="trash"
            label="Delete Plan"
            (clicked)="deletePlan(plan)"
          ></app-button>

          <app-button
            size="iconWithText"
            color="green"
            icon="add"
            label="Add Step"
            (clicked)="openAddStep(plan)"
          ></app-button>
        </div>
      </ion-label>
    </ion-item>
  </ion-list>
</ion-content>

    <app-button
      size="wide"
      color="green"
      icon="add"
      label="New Crisis Plan"
      (clicked)="openAddPlan()"
      style="width: 100%; margin-left: 10%;"
    ></app-button>
<!-- Add Plan Popup -->
<app-custom-text-popup
  #addPlanPopup
  [heading]="'New Crisis Plan'"
  [placeholder]="'Enter crisis plan title'"
  [saveLabel]="'Create'"
  [cancelLabel]="'Cancel'"
  (saved)="handleAddPlan($event)"
></app-custom-text-popup>

<!-- Edit Plan Popup -->
<app-custom-text-popup
  #editPlanPopup
  [heading]="'Edit Plan Title'"
  [placeholder]="'Enter new title'"
  [saveLabel]="'Save'"
  [cancelLabel]="'Cancel'"
  (saved)="handleEditPlan($event)"
></app-custom-text-popup>

<!-- Add/Edit Step Popup -->
<app-custom-text-popup
  #stepPopup
  [heading]="stepPopupHeading"
  [placeholder]="'Enter step'"
  [saveLabel]="stepPopupSaveLabel"
  [cancelLabel]="'Cancel'"
  [multiline]="true"
  (saved)="handleStepSave($event)"
></app-custom-text-popup>